rho = 0.5
trueSigma <- matrix(c(sigma0^2,
rho*sigma0*sigma3,rho*sigma0*sigma3,
sigma3^2),nrow=2,ncol=2)
## generate pred data
x1 <- round(runif(K*Nk,-1,1),3)
x3 <- round(runif(K*Nk,-1,1),3)
x2 <- round(runif(K*Nk,-1,1),3)
dat <- get_data_mam(trueSigma,x1,x2,x3,K,Nk)
View(dat)
f1temp
f1temp <- function(x){(1.5*sin(pi*x)-2*x)}
f1 <- function(x) f1temp(x)-f1temp(0)
f2temp <- function(x){5*(dnorm(2*(x)))}
f2 <- function(x) f2temp(x)-f2temp(0)
beta3 <- 0
source("~/Documents/Research/Bayesian MAM/BMAM/R/SimData.R")
### generate data #######################
dat <- SimData(100,10)
View(dat)
load("data/beavers_brms.rds")
brms_model$backend
source("~/Documents/Research/Bayesian MAM/BMAM/R/bmam.R")
bmam <- bmam(object = brms_model, centered = FALSE,
CI = 0.95, CIType="ETI", posterior = T)
stop("We only support cmdstanr, please change backend of brms to cmdstanr by backend = \"cmdstanr\" ")
source("~/Documents/Research/Bayesian MAM/BMAM/R/bmam.R")
traceplot(brms_model)
plot(
brms_model,
pars = NA,
combo = c("dens", "trace")
)
plot(1:10)
bmam
bmam <- bmam(object = brms_model, centered = FALSE,
CI = 0.95, CIType="ETI", posterior = T)
View(beavers)
object <- bmam
preddat <- object$Preddat # pred data in object
View(preddat)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
## frequentist GAM
## Question: How to center?
gam <- gam(y ~ year + s(timeF) + s(timeM),
data=beavers,family=binomial(),method="REML")
plot(bmam,compared.model = gam, fun = list(f1,f2))
plot(bmam,compared.model = gam, smooth.function = list(f1,f2))
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam,compared.model = gam, smooth.function = list(f1,f2))
plot(bmam,compared.model = gam, smooth.function = list(f1,f2))
tmp <- list(f1,f2)
library(mam)
library(mgcv)
library(gamm4)
library(tidyverse)
library(brms)
library(brmsmargins)
library(data.table)
source("R/bmam.R")
source("R/prediction.R")
source("R/builder.R")
source("R/generate_pred.R")
setwd("~/Documents/Research/Bayesian MAM/BMAM")
library(mam)
library(mgcv)
library(gamm4)
library(tidyverse)
library(brms)
library(brmsmargins)
library(data.table)
source("R/bmam.R")
source("R/prediction.R")
source("R/builder.R")
source("R/generate_pred.R")
### compare with frequentist MAM
### load packages #####################
library(mam)
library(mgcv)
library(gamm4)
library(tidyverse)
library(brms)
library(brmsmargins)
library(data.table)
source("R/bmam.R")
source("R/prediction.R")
source("R/generate_pred.R")
### generate data #######################
dat <- SimData(100,10)
source("R/SimData.R")
### generate data #######################
dat <- SimData(100,10)
source("~/Documents/Research/Bayesian MAM/BMAM/R/SimData.R")
### generate data #######################
dat <- SimData(100,10)
source("~/Documents/Research/Bayesian MAM/BMAM/R/SimData.R")
### generate data #######################
dat <- SimData(100,10)
gridlen <- 100
dat2pred <- data.frame(x1 = c(seq(-1,1,length=gridlen),rep(0,2*gridlen)),
x2 = c(rep(0,gridlen),seq(-1,1,length=gridlen),rep(0,gridlen)),
x3 = c(rep(0,2*gridlen),seq(-1,1,length=gridlen)))
dat2pred$fx1 <- f1(dat2pred$x1)
load("data/simu_brms.rds")
mc <- bmam(object = model_brms,
k=500, preddat = dat2pred,CIType="ETI", CI = 0.95, posterior = T)
mc <- bmam(object = model_brms,
k=500, CIType="ETI", CI = 0.95, posterior = T)
source("~/Documents/Research/Bayesian MAM/BMAM/R/bmam.R")
## preddat
dat2pred <- mc$Preddat
## MAM
themam <- mam::mam(smooth = list(s(x1),s(x2)),
re = y ~ (1+x3|id),
fe = ~ x3,
dat = dat,
margdat = dat,
preddat = dat2pred ,
control = mam_control(
method = 'trust',
varmethod = 1,
verbose = FALSE,
retcond = TRUE))
library(gridExtra)
library(patchwork)
GGPLOTTEXTSIZE <- 15
PLOTWIDTH <- PLOTHEIGHT <- 7
myrange=c(-3,2.5)
theme_set(theme_bw())
theme_replace(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
library(ggplot2)
bmam <- mc
## plot function
plot(bmam)
bmam
source("R/summary.R")
source("R/summary.R")
source("R/plot.bmam.R")
bmam
## plot function
plot(bmam)
## plot function
plot(bmam, compared.model = themam)
source("~/Documents/Research/Bayesian MAM/BMAM/R/SimData.R")
### generate data #######################
dat <- SimData(100,10)
source("~/Documents/Research/Bayesian MAM/BMAM/R/SimData.R")
### generate data #######################
dat <- SimData(100,10)
### generate data #######################
simdata <- SimData(100,10)
fun <- simdata$f
dat <- simdata$data
fun
## plot function
plot(bmam, compared.model = themam, smooth.function = fun)
## plot function
plot(bmam, compared.model = themam, smooth.function = fun)
dfplotBoth <- rbind(dfplotM,dfplotC,dfplotT)
dfplotBoth
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
## plot function
plot(bmam, compared.model = themam, smooth.function = fun)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
## plot function
plot(bmam, compared.model = themam, smooth.function = fun)
## plot function
plot(bmam, compared.model = themam)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
## plot function
plot(bmam, compared.model = themam)
## plot function
plot(bmam, smooth.function = fun)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
## plot function
plot(bmam, smooth.function = fun)
plot(bmam)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam)
exists(dfplotBoth)
exists(dfplotBoth)
exists(a)
exists(x = a)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
exists(x = a)
plot(bmam)
exists("dfplotBoth")
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam)
plot(bmam, compared.model = themam)
plot(bmam, compared.model = themam)
plot(bmam, compared.model = themam, smooth.function = fun)
plot(bmam, compared.model = themam)
a <- plot(bmam, compared.model = themam)
a$Both
a <- 1
rm(a)
a
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam, compared.model = themam)
plot(bmam, compared.model = themam, smooth.function = fun)
plot(bmam, smooth.function = fun)
plot(bmam)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
## source code
source("R/bmam.R")
getwd()
## source code
setwd("/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM")
source("R/bmam.R")
source("R/prediction.R")
source("R/generate_pred.R")
source("R/plot.bmam.R")
source("R/summary.R")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
knitr::root.dir("/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
root.dir= "/Users/pantianyi/Documents/Research/Bayesian"
)
## source code
source("R/bmam.R")
getwd()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
root.dir= "/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM"
)
## source code
source("R/bmam.R")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
root.dir= "/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM/"
)
## source code
gwtwd()
## source code
getwd()
source("R/bmam.R")
getwd()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
root.dir= "/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM"
)
## source code
getwd()
source("R/bmam.R")
getwd()
## source code
getwd()
source("../R/bmam.R")
source("R/prediction.R")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
knitr::opts_knit$set(root.dir = "/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM")
## source code
source("R/bmam.R")
source("R/prediction.R")
source("R/generate_pred.R")
source("R/plot.bmam.R")
source("R/summary.R")
## source code
getwd()
## source code
getwd()
library(mam)
library(mgcv)
library(gamm4)
library(tidyverse)
library(brms)
library(brmsmargins)
library(data.table)
source("R/bmam.R")
source("R/prediction.R")
source("R/generate_pred.R")
source("R/SimData.R")
source("R/summary.R")
source("R/plot.bmam.R")
### generate data #######################
set.seed(123)
simdata <- SimData(100,10)
dat <- simdata$data
fun <- simdata$f
## BMAM
if(TRUE){
# don't run. Very slow. use load("data/simu_brms.rds")
model_brms <- brm(bf(y ~  x3 + s(x1) + s(x2) + (1+x3|id)),
data = dat, family = "bernoulli", cores = 4, seed = 123,
warmup = 1000, iter = 2000, chains = 4, refresh=0, backend = "cmdstanr")
save(model_brms, file = "data/simu_brms.rds")
}
head(dat)
fun
set.seed(123)
simdata <- SimData(K = 100, Nk = 10)
dat <- simdata$data
fun <- simdata$f
head(dat)
fun[[1]]
fun[[1]](1)
f1temp(1)
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow(2,1))
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(2,1))
plot(x, f1)
plot(x, f2)
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(1,2))
plot(x, f1)
plot(x, f2)
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(1,2))
plot(x, f1, size = 1)
plot(x, f2)
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(1,2))
plot(x, f1, size = 0.5)
plot(x, f2)
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(1,2))
plot(x, f1, type = "l")
plot(x, f2, type = "l")
class(model_brms)
bmam <- bmam(object = model_brms,
k=100, CIType="ETI", CI = 0.95)
class(bmam)
plot(bmam)
print(bmam)
bmam
library(brmsmargins)
library(brms)
library(brmsmargins)
bmam
summary(bmam)
bmam
source("~/Documents/Research/Bayesian MAM/BMAM/R/summary.R")
bmam
summary(bmam)
bmam.summary <- summary(bmam)
knitr::kable(bmam.summary)
source("~/Documents/Research/Bayesian MAM/BMAM/R/summary.R")
bmam
head(preddat)
preddat <- generate_pred(object = model_brms, length = 100)
head(preddat)
plot(bmam)
plot(bmam,smooth.function = simdata$f)
plot(bmam,smooth.function = simdata$f)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam,smooth.function = simdata$f)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam,smooth.function = simdata$f)
plot(bmam, smooth.function = simdata$f)
library(mam)
library(mgcv)
bgam <- brm(bf(y ~  x3 + s(x1) + s(x2)),
data = dat, family = "bernoulli", cores = 4, seed = 123,
warmup = 1000, iter = 2000, chains = 4, refresh=0, backend = "cmdstanr")
save(bgam, file = "data/simu_bgam.rds")
## don't run the code above. It's slow.
## load the model from data/simu_bgam.rds
load("data/simu_bgam.rds")
load("data/simu_bgam.rds")
bgam
plot(bmam, compared.model = themam, smooth.function = simdata$f)
themam <- mam::mam(smooth = list(s(x1),s(x2)),
re = y ~ (1+x3|id),
fe = ~ x3,
dat = dat,
margdat = dat,
preddat = bmam$Preddat ,
control = mam_control(
method = 'trust',
varmethod = 1,
verbose = FALSE,
retcond = TRUE))
plot(bmam, compared.model = themam, smooth.function = simdata$f)
plot(bmam, compared.model = themam)
source("~/Documents/Research/Bayesian MAM/BMAM/R/plot.bmam.R")
plot(bmam, compared.model = themam, smooth.function = simdata$f)
plot(bmam, compared.model = themam)
### generate data #######################
set.seed(123)
simdata <- SimData(100,10)
dat <- simdata$data
fun <- simdata$f
### generate data #######################
set.seed(1234)
simdata <- SimData(100,10)
dat <- simdata$data
fun <- simdata$f
if(TRUE){
# don't run. Very slow. use load("data/simu_brms.rds")
model_brms <- brm(bf(y ~  x3 + s(x1) + s(x2) + (1+x3|id)),
data = dat, family = "bernoulli", cores = 4, seed = 1234,
warmup = 1000, iter = 2000, chains = 4, refresh=0, backend = "cmdstanr")
save(model_brms, file = "data/simu_brms.rds")
}
bgam <- brm(bf(y ~  x3 + s(x1) + s(x2)),
data = dat, family = "bernoulli", cores = 4, seed = 1234,
warmup = 1000, iter = 2000, chains = 4, refresh=0, backend = "cmdstanr")
save(bgam, file = "data/simu_bgam.rds")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
knitr::opts_knit$set(root.dir = "/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM")
## source code
source("R/bmam.R")
source("R/prediction.R")
source("R/generate_pred.R")
source("R/plot.bmam.R")
source("R/summary.R")
source("R/SimData.R")
set.seed(1234)
simdata <- SimData(K = 100, Nk = 10)
dat <- simdata$data
fun <- simdata$f
head(dat)
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(1,2))
plot(x, f1, type = "l")
plot(x, f2, type = "l")
x = seq(-1,1,length=1000)
f1 <- fun[[1]](x)
f2 <- fun[[2]](x)
par(mfrow = c(1,2))
plot(x, f1, type = "l")
plot(x, f2, type = "l")
library(brms)
model_brms <- brm(bf(y ~  x3 + s(x1) + s(x2) + (1+x3|id)),
data = dat, family = "bernoulli", cores = 4, seed = 1234,
warmup = 1000, iter = 2000, chains = 4, backend = "cmdstanr")
library(brms)
## don't run the code above. It's very slow.
## load the model from data/simu_brms.rds
load("data/simu_brms.rds")
library(brmsmargins)
library(data.table)
library(dplyr)
library(ggplot2)
bmam <- bmam(object = model_brms, k=100, CIType="ETI", CI = 0.95)
bmam.summary <- summary(bmam)
knitr::kable(bmam.summary[[1]], digits = 3)
knitr::kable(bmam.summary[[2]], digits = 3)
plot(bmam)
plot(bmam, smooth.function = simdata$f)
themam <- mam(smooth = list(s(x1),s(x2)),
re = y ~ (1+x3|id),
fe = ~ x3,
dat = dat,
margdat = dat,
preddat = bmam$Preddat ,
control = mam_control(
method = 'trust',
varmethod = 1,
verbose = FALSE,
retcond = TRUE))
bmam$Preddat
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
cache = TRUE,
fig.width = 5,
fig.height = 4
)
knitr::opts_knit$set(root.dir = "/Users/pantianyi/Documents/Research/Bayesian MAM/BMAM")
plot(
model_brms,
combo = c("trace")
)
model_brms
plot(
model_brms
)
plot(
model_brms,
combo = c("trace","trace")
)
plot(
model_brms,
combo = c("trace")
)
traceplot(model_brms)
